# Web-based Interactive Development Pod Template
#
# PURPOSE:
#   Provides browser-based VS Code (code-server) for development
#   Alternative to SSH-based pods (pod-ssh.yml)
#
# FEATURES:
#   - Runs code-server (web-based VS Code) on port 9000
#   - No authentication required (use port-forward for security)
#   - GPU access (amd.com/gpu: 1)
#   - Persistent storage via PVC
#
# USAGE:
#   1. Replace {{POD_NAME}} and {{PVC_CLAIM_NAME}} with actual values
#   2. Apply: kubectl apply -f pod-web.yml -n iree-dev
#   3. Port-forward: kubectl port-forward <pod-name> 9000:9000 -n iree-dev
#   4. Access: http://localhost:9000 in your browser
#
# NOTE: Currently a template only - no wrapper script like connect.sh
#       You'll need to manually substitute variables and apply
#
apiVersion: v1
kind: Pod
metadata:
  name: {{POD_NAME}}
spec:
  volumes:
    - name: home-vol
      persistentVolumeClaim:
        claimName: {{PVC_CLAIM_NAME}}
  securityContext:
    runAsUser: 1001
    runAsGroup: 1001
    fsGroup: 1001
  containers:
    - name: interactive-web
      image: ghcr.io/nod-ai/ossci-gitops/rocm-dev:ossci-test@sha256:af655ad69c46c7af76db58c597d82d277c4f71d1343b2867c85b2bc77a66ca6a
      imagePullPolicy: IfNotPresent
      command:
        - /bin/bash
        - -c
        - |
          set -eux
          sudo apt-get update && sudo apt-get install -y curl
          sudo chown -R ossci:ossci /home/ossci
          curl -fsSL https://code-server.dev/install.sh | sh
          code-server --auth none --port 9000
      tty: true
      stdin: true
      volumeMounts:
        - name: home-vol
          mountPath: /home/ossci
          readOnly: false
      resources:
        limits:
          amd.com/gpu: 1
